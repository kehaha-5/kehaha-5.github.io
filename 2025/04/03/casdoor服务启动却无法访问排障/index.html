<!DOCTYPE html>
<html lang=zh-CN>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:description" content="">
    <meta property="og:type" content="website">
    <meta name="description" content="">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        casdooræœåŠ¡å¯åŠ¨å´æ— æ³•è®¿é—®æ’éšœ - kehaha-5
        
    </title>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/aircloud.css">

    
<link rel="stylesheet" href="/css/gitment.css">

    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_28hi1hpxx24.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>

    









<meta name="generator" content="Hexo 7.3.0"></head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> Just record it ! </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar radius">
            <img src="/img/avatar.jpg" />
        </div>
        <div class="name">
            <i>kehaha-5</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>ä¸»é¡µ</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>æ ‡ç­¾</span>
                </a>
            </li>
            <li >
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>å­˜æ¡£</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>å…³äº</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>æœç´¢</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83"><span class="toc-text">ç¯å¢ƒ</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8E%92%E6%9F%A5"><span class="toc-text">æ’æŸ¥</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91"><span class="toc-text">ç«¯å£è½¬å‘</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#strace-pstack%E6%9F%A5%E7%9C%8B%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8"><span class="toc-text">strace\pstackæŸ¥çœ‹ç³»ç»Ÿè°ƒç”¨</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%F0%9F%A4%94"><span class="toc-text">é—®é¢˜ğŸ¤”</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88casdoor%E5%90%AF%E5%8A%A8%E6%97%B6%E8%A6%81%E5%8E%BB%E8%AE%BF%E9%97%AEsession%E6%96%87%E4%BB%B6"><span class="toc-text">ä¸ºä»€ä¹ˆcasdoorå¯åŠ¨æ—¶è¦å»è®¿é—®sessionæ–‡ä»¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E6%9C%8D%E5%8A%A1%E6%97%A5%E5%BF%97%E9%83%BD%E6%98%BE%E7%A4%BA%E7%AB%AF%E5%8F%A3%E5%B7%B2%E7%BB%8F%E7%9B%91%E5%90%AC%E4%BA%86%EF%BC%8C%E4%BD%86%E6%98%AFcurl%E8%AF%A5%E6%9C%8D%E5%8A%A1%E8%BF%98%E6%98%AF%E4%B8%8D%E8%83%BD%E9%A9%AC%E4%B8%8A%E8%BF%94%E5%9B%9E%E8%AF%B7%E6%B1%82"><span class="toc-text">ä¸ºä»€ä¹ˆæœåŠ¡æ—¥å¿—éƒ½æ˜¾ç¤ºç«¯å£å·²ç»ç›‘å¬äº†ï¼Œä½†æ˜¯curlè¯¥æœåŠ¡è¿˜æ˜¯ä¸èƒ½é©¬ä¸Šè¿”å›è¯·æ±‚</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E4%BA%A7%E7%94%9F%E8%BF%99%E4%B9%88%E5%A4%9Atmp%E6%96%87%E4%BB%B6"><span class="toc-text">ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿè¿™ä¹ˆå¤štmpæ–‡ä»¶</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">æ€»ç»“</span></a></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-bg" id="search-bg"></div>
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">æœç´¢</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i> Just record it ! </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        casdooræœåŠ¡å¯åŠ¨å´æ— æ³•è®¿é—®æ’éšœ
    </div>

    <div class="post-meta">
        <span class="attr">å‘å¸ƒäºï¼š<span>2025-04-03 14:45:03</span></span>
        
        <span class="attr">æ ‡ç­¾ï¼š/
        
        <a class="tag" href="/tags/#æ’éšœ" title="æ’éšœ">æ’éšœ</a>
        <span>/</span>
        
        <a class="tag" href="/tags/#casdoor" title="casdoor">casdoor</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">è®¿é—®ï¼š<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content no-indent">
        <blockquote>
<p>æœ€è¿‘ï¼Œæˆ‘ä»¬å›¢é˜Ÿåœ¨ç”Ÿäº§ç¯å¢ƒä¸­é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯casdooræœåŠ¡é‡å¯åï¼Œæ—¥å¿—ä¹Ÿæ˜¾ç¤ºå‡ºæ¥äº†ï¼Œä½†æ˜¯å°±æ˜¯æ— æ³•è®¿é—®ï¼Œä½¿ç”¨curlåœ¨æœ¬åœ°è®¿é—®ä¹Ÿæ˜¯ä¸é€šã€‚</p>
</blockquote>
<p>æ—¥å¿—ï¼š</p>
<p><img src="/2025/04/03/casdoor%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8%E5%8D%B4%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AE%E6%8E%92%E9%9A%9C/casdoor-log.png" alt="log"></p>
<p>é¦–å…ˆå…ˆç®€ç»ä¸€ä¸‹casdooræ˜¯ä»€ä¹ˆ<a target="_blank" rel="noopener" href="https://casdoor.org/zh/docs/overview">æ¦‚è¿° | Casdoor Â· An open-source UI-first Identity and Access Management (IAM) &#x2F; Single-Sign-On (SSO) platform with web UI supporting OAuth 2.0, OIDC, SAML, CAS, LDAP, SCIM, WebAuthn, TOTP, MFA, RADIUS, Google Workspace, Active Directory and Kerberos</a></p>
<p>ç®€å•ç‚¹ç†è§£å°±æ˜¯å®ƒæ˜¯ä¸€ä¸ªå®ç°äº†<code>OAuth 2.0</code>è®¤è¯çš„ä¸€ä¸ªæœåŠ¡ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒæ¥å®Œæˆä¸€ä¸ªè´¦å·å¯¹å¤šä¸ªåº”ç”¨è¿›è¡Œæ— æ„Ÿç™»å½•ï¼ŒåŒæ—¶å¯ä»¥æŠŠç”¨æˆ·æ•°æ®æ”¾åˆ°<code>casdoor</code>ä¸­ï¼Œå…¶å®ƒåº”ç”¨çš„æ•°æ®åº“å¯ä»¥åªç”¨æ¥å­˜æ”¾ä¸šåŠ¡æ•°æ®ã€‚</p>
<h1 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h1><p>æ ¹æ®ç›¸å…³åŒå­¦çš„æè¿°ï¼Œç”Ÿäº§ç¯å¢ƒçš„<code>casdoor</code>ç¯å¢ƒå¦‚ä¸‹ã€‚</p>
<ul>
<li>3å°æœåŠ¡å™¨ä½¿ç”¨<code>docker</code>æˆ–<code>podman</code>å¯åŠ¨äº†ä¸€ä¸ª<code>casdoor</code>æœåŠ¡ï¼Œå®ç°é«˜å¯ç”¨</li>
<li>3å°æœåŠ¡å™¨åŒæ—¶ä½¿ç”¨åŒä¸€ä¸ªæ•°æ®åº“(<code>mysql</code>)</li>
<li>ä½¿ç”¨nfsæ¥åŒæ­¥<code>casdoor</code>ä¸­çš„<code>tmp</code>æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸º<code>casdoor</code>çš„é»˜è®¤<code>session</code>ä¿å­˜ä½ç½®<ul>
<li><a target="_blank" rel="noopener" href="https://casdoor.org/zh/docs/basic/server-installation/#%E9%80%9A%E8%BF%87-ini-%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE:~:text=redisEndpoint%20%E5%90%8E%E5%A1%AB%E5%86%99,provider%2Dconfig%E3%80%82">sessioné…ç½®çš„ç›¸å…³æ–‡æ¡£</a></li>
<li>å½“æ—¶è¯¥ tmp æ–‡ä»¶å¤§å°è‡³å°‘æœ‰40Gï¼Œä½†æ˜¯æˆ‘ä»¬ç¯å¢ƒå½“å‰çš„ç”¨æˆ·æ•°é‡ä¸è‡³äºä¼šæœ‰è¿™ä¹ˆå¤šçš„<code>session</code>ç¼“å­˜</li>
<li><code>nfs</code>å¯¹åº”æŒ‚è½½æœåŠ¡çš„è¿›ç¨‹å ç”¨è¿‡é«˜çš„<code>cpu</code></li>
</ul>
</li>
<li><code>casdoor</code>çš„ç‰ˆæœ¬ä¸º1.814ï¼Œå…¶ä¸­çš„<code>beego</code>ç‰ˆæœ¬ä¸º1.12.3</li>
</ul>
<h1 id="æ’æŸ¥"><a href="#æ’æŸ¥" class="headerlink" title="æ’æŸ¥"></a>æ’æŸ¥</h1><p>åç»­çš„æ’æŸ¥ç¯å¢ƒæ˜¯åœ¨æµ‹è¯•ç¯å¢ƒä¸­æ­å»ºçš„ï¼Œå¹¶ä¸”å¤åˆ»äº†å¯¹åº”çš„é—®é¢˜ã€‚ç¯å¢ƒå¦‚ä¸‹</p>
<ul>
<li>ä½¿ç”¨<code>dcoker-compose</code>å¯åŠ¨äº†3ä¸ª<code>casdoor</code>å’Œä¸€ä¸ª<code>mysql</code></li>
<li>å®¿ä¸»æœºçš„<code>8001</code>,<code>8002</code>,<code>8003</code>åˆ†åˆ«æ˜ å°„3ä¸ª<code>casdoor</code>çš„8000ç«¯å£</li>
<li>ä½¿ç”¨äº† docker çš„æŒ‚è½½æŠŠtmpæ–‡ä»¶åŒæ—¶æŒ‚è½½åˆ°äº†æ¯ä¸ª<code>casdoor</code>çš„ç›®å½•ï¼ˆæ¨¡æ‹Ÿ<code>nfs</code>ï¼‰</li>
<li><code>tmp</code>çš„æ–‡ä»¶å¤§å°ä¸º<code>31G</code></li>
</ul>
<h2 id="ç«¯å£è½¬å‘"><a href="#ç«¯å£è½¬å‘" class="headerlink" title="ç«¯å£è½¬å‘"></a>ç«¯å£è½¬å‘</h2><p>å› ä¸ºæœåŠ¡æ˜¯ä½¿ç”¨dockerå¯åŠ¨çš„ï¼Œå¹¶ä¸”ä½¿ç”¨çš„ç½‘ç»œæ¨¡å¼ä¸º<code>Bridge</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæ’æŸ¥<code>docker</code>ç½‘ç»œç›¸å…³çš„é—®é¢˜ã€‚</p>
<p>å…ˆ <code>curl</code> <code>docker</code>çš„ç½‘å¡(<code>docker0</code>)çš„<code>ip</code>åœ°å€ï¼Œä½†æ˜¯è¿˜æ˜¯ <code>curl</code> ä¸é€šç›¸å…³æœåŠ¡ã€‚</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rocky-testing casdoor<span class="token punctuation">]</span><span class="token comment"># ss -anpl | grep 8001 # æŸ¥çœ‹ç«¯å£ç›‘å¬æƒ…å†µ</span>
tcp   LISTEN <span class="token number">0</span>      <span class="token number">4096</span>  <span class="token number">0.0</span>.0.0:8001             <span class="token number">0.0</span>.0.0:*    users:<span class="token variable"><span class="token punctuation">((</span>"docker<span class="token operator">-</span>proxy"<span class="token punctuation">,</span>pid<span class="token operator">=</span><span class="token number">1456272</span><span class="token punctuation">,</span>fd<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">))</span></span> 
tcp   LISTEN <span class="token number">0</span>      <span class="token number">4096</span> <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:8001                <span class="token punctuation">[</span>::<span class="token punctuation">]</span>:*    users:<span class="token variable"><span class="token punctuation">((</span>"docker<span class="token operator">-</span>proxy"<span class="token punctuation">,</span>pid<span class="token operator">=</span><span class="token number">1456280</span><span class="token punctuation">,</span>fd<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">))</span></span>     
<span class="token punctuation">[</span>root@rocky-testing casdoor<span class="token punctuation">]</span><span class="token comment"># ifconfig docker0 #è·å–dockerçš„ç½‘å¡</span>
docker0: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">409</span><span class="token operator"><span class="token file-descriptor important">9</span>&lt;</span>UP,BROADCAST,MULTICAST<span class="token operator">></span>  mtu <span class="token number">1500</span>
        inet <span class="token number">172.17</span>.0.1  netmask <span class="token number">255.255</span>.0.0  broadcast <span class="token number">172.17</span>.255.255
        inet6 fe80::1469:daff:febf:1315  prefixlen <span class="token number">64</span>  scopeid 0x2<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>link<span class="token operator">></span>
        ether <span class="token number">16</span>:69:da:bf:13:15  txqueuelen <span class="token number">0</span>  <span class="token punctuation">(</span>Ethernet<span class="token punctuation">)</span>
        RX packets <span class="token number">32519</span>  bytes <span class="token number">2160933</span> <span class="token punctuation">(</span><span class="token number">2.0</span> MiB<span class="token punctuation">)</span>
        RX errors <span class="token number">0</span>  dropped <span class="token number">0</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span>
        TX packets <span class="token number">37734</span>  bytes <span class="token number">94754551</span> <span class="token punctuation">(</span><span class="token number">90.3</span> MiB<span class="token punctuation">)</span>
        TX errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span>

<span class="token punctuation">[</span>root@rocky-testing casdoor<span class="token punctuation">]</span><span class="token comment"># curl 172.17.0.1:8001 # curl å¯¹åº”çš„ç½‘å¡ip 8001ä¸ºcasdoorå¯åŠ¨çš„ç«¯å£</span></code></pre>

<p>ä½¿ç”¨<code>nsenter </code> è¿›å…¥å¯¹åº”æœåŠ¡çš„<code>network ns</code>ï¼Œå¹¶å°è¯•<code>curl</code>è®¿é—®æœåŠ¡ï¼Œä½†è¿˜æ˜¯æ— æ³•è®¿é—®</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rocky-testing casdoor<span class="token punctuation">]</span><span class="token comment"># docker compose top casdoor-1 # è·å–åº”ç”¨çš„pid</span>
WARN<span class="token punctuation">[</span>0000<span class="token punctuation">]</span> /root/test/casdoor/docker-compose.yaml: the attribute <span class="token variable"><span class="token variable">`</span>version<span class="token variable">`</span></span> is obsolete, it will be ignored, please remove it to avoid potential confusion 
casdoor-1
<span class="token environment constant">UID</span>    PID       <span class="token environment constant">PPID</span>      C    STIME   TTY   TIME       CMD
<span class="token number">1000</span>   <span class="token number">1456231</span>   <span class="token number">1456210</span>   <span class="token number">4</span>    <span class="token number">14</span>:58   ?     00:01:21   /server   
<span class="token punctuation">[</span>root@rocky-testing casdoor<span class="token punctuation">]</span><span class="token comment"># nsenter -n --target 1456231 # è¿›å…¥å¯¹åº”çš„ ns</span>
<span class="token punctuation">[</span>root@rocky-testing casdoor<span class="token punctuation">]</span><span class="token comment"># ip link # æŸ¥çœ‹ç½‘å¡ï¼Œè·Ÿå®¿ä¸»æœºçš„ç½‘å¡ä¸ä¸€è‡´ï¼Œåªå‰©ä¸‹loå’Œeth0ç½‘å¡ï¼Œè¯´æ˜è¿›å…¥äº†å®¹å™¨çš„nsä¸­</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN mode DEFAULT group default qlen <span class="token number">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
<span class="token number">2</span>: eth0@if898: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">1500</span> qdisc noqueue state UP mode DEFAULT group default 
    link/ether <span class="token number">82</span>:2e:b0:c9:cc:00 brd ff:ff:ff:ff:ff:ff link-netnsid <span class="token number">0</span>
<span class="token punctuation">[</span>root@rocky-testing casdoor<span class="token punctuation">]</span><span class="token comment"># ss -anlp | grep 8000 # æŸ¥çœ‹ç«¯å£å ç”¨ï¼Œç¡®å®æœåŠ¡å·²ç»å¯åŠ¨ </span>
tcp   LISTEN <span class="token number">0</span>      <span class="token number">4096</span>               *:8000               *:*    users:<span class="token variable"><span class="token punctuation">((</span>"server"<span class="token punctuation">,</span>pid<span class="token operator">=</span><span class="token number">1456231</span><span class="token punctuation">,</span>fd<span class="token operator">=</span><span class="token number">13</span><span class="token punctuation">))</span></span>
<span class="token punctuation">[</span>root@rocky-testing casdoor<span class="token punctuation">]</span><span class="token comment"># curl 0.0.0.0:8000 # æ— æ³•curlé€šæœåŠ¡</span>
<span class="token punctuation">[</span>root@rocky-testing casdoor<span class="token punctuation">]</span><span class="token comment"># exit # é€€å‡ºå¯¹åº”ns</span>
<span class="token builtin class-name">logout</span></code></pre>

<h2 id="strace-pstackæŸ¥çœ‹ç³»ç»Ÿè°ƒç”¨"><a href="#strace-pstackæŸ¥çœ‹ç³»ç»Ÿè°ƒç”¨" class="headerlink" title="strace\pstackæŸ¥çœ‹ç³»ç»Ÿè°ƒç”¨"></a>strace\pstackæŸ¥çœ‹ç³»ç»Ÿè°ƒç”¨</h2><p>åœ¨ä¸Šè¿°çš„ä¸¤æ­¥æ“ä½œåï¼Œè¿˜æ˜¯<code>curl</code>ä¸é€šï¼Œè¯´æ˜æœåŠ¡è™½ç„¶æ—¥å¿—å·²ç»æ‰“å°äº†ï¼Œä½†æ˜¯æœåŠ¡è¿˜æœªå¯ç”¨ã€‚</p>
<p>ä½¿ç”¨<code>strace</code>å’Œ<code>pstack</code>å‘½ä»¤æŸ¥çœ‹å¯¹åº”åº”ç”¨çš„ç³»ç»Ÿè°ƒç”¨ï¼ŒæŸ¥çœ‹casdoorçš„å¯åŠ¨åçš„è¡Œä¸º</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">strace</span> <span class="token parameter variable">-p</span> <span class="token number">1456231</span> <span class="token parameter variable">-f</span> <span class="token parameter variable">-o</span> ./strace-casdoor-1.log 
pstack <span class="token number">1456231</span> <span class="token operator">></span> ./pstack-casdoor-1.log</code></pre>

<p>æŸ¥çœ‹å…¶æ—¥å¿—ï¼Œä»¥ä¸‹æ—¥å¿—å†…å®¹ä¸ºç”Ÿäº§ç¯å¢ƒä¸­è·å–çš„<code>strace</code>å’Œ<code>pstack</code>æ—¥å¿—</p>
<pre class="language-log" data-language="log"><code class="language-log"><span class="token operator">#</span> åˆ†æstraceçš„æ—¥å¿—ï¼Œå‘ç°ç¨‹åºæ˜¯æœ‰è§„å¾‹çš„æ‰§è¡Œä»¥ä¸‹ç³»ç»Ÿè°ƒç”¨
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> éƒ½æ˜¯nanosleep<span class="token operator">(</span><span class="token operator">&#123;</span>tv_sec<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> tv_nsec<span class="token operator">=</span><span class="token number">20000</span><span class="token operator">&#125;</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token operator">)</span> <span class="token operator">=</span> <span class="token number">0</span> çš„è°ƒç”¨
<span class="token number">1146720</span> nanosleep<span class="token operator">(</span><span class="token operator">&#123;</span>tv_sec<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> tv_nsec<span class="token operator">=</span><span class="token number">20000</span><span class="token operator">&#125;</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token operator">)</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token number">1146720</span> futex<span class="token operator">(</span><span class="token number">0x45252c0</span><span class="token punctuation">,</span> FUTEX_WAIT_PRIVATE<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&#123;</span>tv_sec<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> tv_nsec<span class="token operator">=</span><span class="token number">103439635</span><span class="token operator">&#125;</span> <span class="token operator">&lt;</span>unfinished <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">></span>
<span class="token number">1146729</span> <span class="token operator">&lt;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> newfstatat resumed<span class="token operator">></span><span class="token operator">&#123;</span>st_mode<span class="token operator">=</span>S_IFREG<span class="token operator">|</span><span class="token number">0644</span><span class="token punctuation">,</span> st_size<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">&#125;</span><span class="token punctuation">,</span> AT_SYMLINK_NOFOLLOW<span class="token operator">)</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token number">1146729</span> <span class="token separator comment">---</span> SIGURG <span class="token operator">&#123;</span>si_signo<span class="token operator">=</span>SIGURG<span class="token punctuation">,</span> si_code<span class="token operator">=</span>SI_TKILL<span class="token punctuation">,</span> si_pid<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> si_uid<span class="token operator">=</span><span class="token number">1000</span><span class="token operator">&#125;</span> <span class="token separator comment">---</span>
<span class="token number">1146729</span> rt_sigreturn<span class="token operator">(</span><span class="token operator">&#123;</span>mask<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&#125;</span><span class="token operator">)</span>         <span class="token operator">=</span> <span class="token number">0</span>
<span class="token number">1146729</span> futex<span class="token operator">(</span><span class="token number">0x45252c0</span><span class="token punctuation">,</span> FUTEX_WAKE_PRIVATE<span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">)</span> <span class="token operator">=</span> <span class="token number">1</span>
<span class="token number">1146720</span> <span class="token operator">&lt;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> futex resumed<span class="token operator">></span><span class="token operator">)</span>            <span class="token operator">=</span> <span class="token number">0</span>
<span class="token number">1146729</span> newfstatat<span class="token operator">(</span>AT_FDCWD<span class="token punctuation">,</span> <span class="token string">"tmp/0/0/001575f66990e62d6ed701f24599e1ca"</span><span class="token punctuation">,</span>  <span class="token operator">&lt;</span>unfinished <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">></span>
<span class="token number">1146720</span> nanosleep<span class="token operator">(</span><span class="token operator">&#123;</span>tv_sec<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> tv_nsec<span class="token operator">=</span><span class="token number">20000</span><span class="token operator">&#125;</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token operator">)</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token number">1146720</span> futex<span class="token operator">(</span><span class="token number">0x45252c0</span><span class="token punctuation">,</span> FUTEX_WAIT_PRIVATE<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&#123;</span>tv_sec<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> tv_nsec<span class="token operator">=</span><span class="token number">43396353</span><span class="token operator">&#125;</span> <span class="token operator">&lt;</span>unfinished <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">></span>
<span class="token number">1146704</span> <span class="token operator">&lt;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> epoll_pwait resumed<span class="token operator">></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">998</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token operator">)</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token number">1146704</span> epoll_pwait<span class="token operator">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token operator">)</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token number">1146704</span> epoll_pwait<span class="token operator">(</span><span class="token number">4</span><span class="token punctuation">,</span>  <span class="token operator">&lt;</span>unfinished <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">></span>
<span class="token number">1146720</span> <span class="token operator">&lt;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> futex resumed<span class="token operator">></span><span class="token operator">)</span>            <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span> ETIMEDOUT <span class="token operator">(</span>Connection timed out<span class="token operator">)</span>
<span class="token number">1146720</span> nanosleep<span class="token operator">(</span><span class="token operator">&#123;</span>tv_sec<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> tv_nsec<span class="token operator">=</span><span class="token number">20000</span><span class="token operator">&#125;</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token operator">)</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> éƒ½æ˜¯nanosleep<span class="token operator">(</span><span class="token operator">&#123;</span>tv_sec<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> tv_nsec<span class="token operator">=</span><span class="token number">20000</span><span class="token operator">&#125;</span><span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token operator">)</span> <span class="token operator">=</span> <span class="token number">0</span> çš„è°ƒç”¨
<span class="token operator">#</span> åˆ†æpstackæ—¥å¿—ï¼Œç¨‹åºä¹Ÿæ˜¯ä¸åœåœ°æ‰§è¡Œä»¥ä¸‹æ–¹æ³•
 <span class="token number">37028.625</span> <span class="token operator">(</span><span class="token number">47.259</span> ms<span class="token operator">)</span><span class="token operator">:</span> server<span class="token operator">/</span><span class="token number">1146720</span>  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span>continued<span class="token punctuation">]</span><span class="token operator">:</span> futex<span class="token operator">(</span><span class="token operator">)</span><span class="token operator">)</span>                                            <span class="token operator">=</span> <span class="token number">0</span>
 <span class="token number">37075.871</span> <span class="token operator">(</span>         <span class="token operator">)</span><span class="token operator">:</span> server<span class="token operator">/</span><span class="token number">1146729</span> newfstatat<span class="token operator">(</span>dfd<span class="token operator">:</span> CWD<span class="token punctuation">,</span> filename<span class="token operator">:</span> <span class="token number">0xb77bf0</span><span class="token punctuation">,</span> statbuf<span class="token operator">:</span> <span class="token number">0xc000adced8</span><span class="token punctuation">,</span> flag<span class="token operator">:</span> SYMLINK_NOFOLLOW<span class="token operator">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 <span class="token number">37075.900</span> <span class="token operator">(</span> <span class="token number">0.058</span> ms<span class="token operator">)</span><span class="token operator">:</span> server<span class="token operator">/</span><span class="token number">1146720</span> nanosleep<span class="token operator">(</span>rqtp<span class="token operator">:</span> <span class="token number">0xc00008ff10</span><span class="token operator">)</span>                                         <span class="token operator">=</span> <span class="token number">0</span>
 <span class="token number">37075.871</span> <span class="token operator">(</span><span class="token number">62.859</span> ms<span class="token operator">)</span><span class="token operator">:</span> server<span class="token operator">/</span><span class="token number">1146729</span>  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span>continued<span class="token punctuation">]</span><span class="token operator">:</span> newfstatat<span class="token operator">(</span><span class="token operator">)</span><span class="token operator">)</span>                                       <span class="token operator">=</span> <span class="token number">0</span>
 <span class="token number">37075.965</span> <span class="token operator">(</span>         <span class="token operator">)</span><span class="token operator">:</span> server<span class="token operator">/</span><span class="token number">1146720</span> futex<span class="token operator">(</span>uaddr<span class="token operator">:</span> <span class="token number">0x45252c0</span><span class="token punctuation">,</span> op<span class="token operator">:</span> WAIT<span class="token operator">|</span>PRIVATE_FLAG<span class="token punctuation">,</span> utime<span class="token operator">:</span> <span class="token number">0xc00008feb0</span><span class="token operator">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 <span class="token number">37138.754</span> <span class="token operator">(</span> <span class="token number">0.012</span> ms<span class="token operator">)</span><span class="token operator">:</span> server<span class="token operator">/</span><span class="token number">1146729</span> futex<span class="token operator">(</span>uaddr<span class="token operator">:</span> <span class="token number">0x45252c0</span><span class="token punctuation">,</span> op<span class="token operator">:</span> WAKE<span class="token operator">|</span>PRIVATE_FLAG<span class="token punctuation">,</span> val<span class="token operator">:</span> <span class="token number">1</span><span class="token operator">)</span>                <span class="token operator">=</span> <span class="token number">1</span>
 <span class="token number">37075.965</span> <span class="token operator">(</span><span class="token number">62.898</span> ms<span class="token operator">)</span><span class="token operator">:</span> server<span class="token operator">/</span><span class="token number">1146720</span>  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span>continued<span class="token punctuation">]</span><span class="token operator">:</span> futex<span class="token operator">(</span><span class="token operator">)</span><span class="token operator">)</span>                                            <span class="token operator">=</span> <span class="token number">0</span>
 <span class="token number">37138.781</span> <span class="token operator">(</span>         <span class="token operator">)</span><span class="token operator">:</span> server<span class="token operator">/</span><span class="token number">1146729</span> newfstatat<span class="token operator">(</span>dfd<span class="token operator">:</span> CWD<span class="token punctuation">,</span> filename<span class="token operator">:</span> <span class="token number">0xb77c50</span><span class="token punctuation">,</span> statbuf<span class="token operator">:</span> <span class="token number">0xc000adcfa8</span><span class="token punctuation">,</span> flag<span class="token operator">:</span> SYMLINK_NOFOLLOW<span class="token operator">)</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 <span class="token number">37138.881</span> <span class="token operator">(</span> <span class="token number">0.067</span> ms<span class="token operator">)</span><span class="token operator">:</span> server<span class="token operator">/</span><span class="token number">1146720</span> nanosleep<span class="token operator">(</span>rqtp<span class="token operator">:</span> <span class="token number">0xc00008ff10</span><span class="token operator">)</span>                                         <span class="token operator">=</span> <span class="token number">0</span>
 <span class="token number">37138.954</span> <span class="token operator">(</span><span class="token number">25.650</span> ms<span class="token operator">)</span><span class="token operator">:</span> server<span class="token operator">/</span><span class="token number">1146720</span> futex<span class="token operator">(</span>uaddr<span class="token operator">:</span> <span class="token number">0x45252c0</span><span class="token punctuation">,</span> op<span class="token operator">:</span> WAIT<span class="token operator">|</span>PRIVATE_FLAG<span class="token punctuation">,</span> utime<span class="token operator">:</span> <span class="token number">0xc00008feb0</span><span class="token operator">)</span>   <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span> ETIMEDOUT <span class="token operator">(</span>Connection timed out<span class="token operator">)</span>
 <span class="token number">37164.628</span> <span class="token operator">(</span> <span class="token number">0.088</span> ms<span class="token operator">)</span><span class="token operator">:</span> server<span class="token operator">/</span><span class="token number">1146720</span> nanosleep<span class="token operator">(</span>rqtp<span class="token operator">:</span> <span class="token number">0xc00008ff10</span><span class="token operator">)</span>                                         <span class="token operator">=</span> <span class="token number">0</span>
 <span class="token number">37164.724</span> <span class="token operator">(</span> <span class="token number">0.110</span> ms<span class="token operator">)</span><span class="token operator">:</span> server<span class="token operator">/</span><span class="token number">1146720</span> nanosleep<span class="token operator">(</span>rqtp<span class="token operator">:</span> <span class="token number">0xc00008ff10</span><span class="token operator">)</span>                                         <span class="token operator">=</span> <span class="token number">0</span>
 <span class="token number">37164.845</span> <span class="token operator">(</span> <span class="token number">0.085</span> ms<span class="token operator">)</span><span class="token operator">:</span> server<span class="token operator">/</span><span class="token number">1146720</span> nanosleep<span class="token operator">(</span>rqtp<span class="token operator">:</span> <span class="token number">0xc00008ff10</span><span class="token operator">)</span>                                         <span class="token operator">=</span> <span class="token number">0</span></code></pre>

<p>é€šè¿‡ä¸Šè¿°çš„åˆ†æï¼Œå¯ä»¥å‘ç°<code>casdoor</code>ç¨‹åºåœ¨å¯åŠ¨åï¼Œä¸€ç›´è¯»å–<code>tmp</code>ç›®å½•ä¸‹çš„æ–‡ä»¶ä¿¡æ¯(å¹¶ä¸”å…¶ä¸­è¿˜æœ‰ä¸€ä¸ªé”)ï¼Œç»“åˆå‰é¢çš„ä¿¡æ¯å¯ä»¥å¾—å‡º<code>casdoor</code>åœ¨å¯åŠ¨çš„æ—¶å€™ä¼šä¸€ç›´è¯»å–<code>tmp</code>é‡Œé¢çš„<code>session</code>ä¿¡æ¯ï¼Œå¯¼è‡´<code>nfs</code>çš„è¿›ç¨‹çš„<code>cpu</code>ä½¿ç”¨ç‡è¿‡é«˜ã€‚</p>
<p>æ‰€ä»¥åé¢åœ¨ç”Ÿäº§ç¯å¢ƒä¸­æŠŠ<code>nfs</code>çš„æŒ‚è½½ç»™å–æ¶ˆäº†(<code>tmp</code>ä¸­çš„<code>session</code>æ–‡ä»¶å°±ä¼šè¢«æ¸…ç©ºï¼Œå˜æˆä¸€ä¸ªç©ºæ–‡ä»¶å¤¹)ï¼Œåé¢å†å¯åŠ¨ï¼Œå°±å¯ä»¥æ­£å¸¸è®¿é—®æœåŠ¡äº†ï¼Œåç»­å¯èƒ½ä¼šè€ƒè™‘æŠŠ<code>session</code>æ”¾åˆ°<code>redis</code>ä¸­è¿›è¡Œå¤„ç†ã€‚</p>
<h1 id="é—®é¢˜ğŸ¤”"><a href="#é—®é¢˜ğŸ¤”" class="headerlink" title="é—®é¢˜ğŸ¤”"></a>é—®é¢˜ğŸ¤”</h1><p>è™½ç„¶æœåŠ¡å¯ä»¥å¯åŠ¨äº†ä½†æ˜¯ç•™ä¸‹äº†3ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li><strong>ä¸ºä»€ä¹ˆcasdoorå¯åŠ¨çš„æ—¶å€™è¦å»è®¿é—®sessionæ–‡ä»¶(tmpç›®å½•ä¸‹çš„æ–‡ä»¶)</strong></li>
<li><strong>ä¸ºä»€ä¹ˆcasdoorçš„æ—¥å¿—éƒ½æ˜¾ç¤ºæœåŠ¡çš„ç«¯å£å·²ç»ç›‘å¬äº†ï¼Œä½†æ˜¯curlè¯¥æœåŠ¡è¿˜æ˜¯ä¸èƒ½é©¬ä¸Šè¿”å›è¯·æ±‚</strong></li>
<li><strong>åŒå­¦åæ˜ è¯¥tmpæ–‡ä»¶ä¹‹å‰å·²ç»æ¸…ç†è¿‡ä¸€æ¬¡äº†ï¼Œä½†æ˜¯ä¸€å¤©å·¦å³ç£ç›˜å ç”¨ç‡åˆä¸Šæ¥äº†è¿™æ˜¯ä¸ºä»€ä¹ˆ</strong></li>
</ul>
<p>é’ˆå¯¹ä¸Šé¢çš„3ä¸ªé—®é¢˜ï¼Œæˆ‘é€‰æ‹© <code>æºç </code> å¯åŠ¨ğŸ‘€</p>
<h2 id="ä¸ºä»€ä¹ˆcasdoorå¯åŠ¨æ—¶è¦å»è®¿é—®sessionæ–‡ä»¶"><a href="#ä¸ºä»€ä¹ˆcasdoorå¯åŠ¨æ—¶è¦å»è®¿é—®sessionæ–‡ä»¶" class="headerlink" title="ä¸ºä»€ä¹ˆcasdoorå¯åŠ¨æ—¶è¦å»è®¿é—®sessionæ–‡ä»¶"></a>ä¸ºä»€ä¹ˆcasdoorå¯åŠ¨æ—¶è¦å»è®¿é—®sessionæ–‡ä»¶</h2><p>ä¸ºä»€ä¹ˆcasdoorå¯åŠ¨è¦å»è®¿é—®sessionæ–‡ä»¶</p>
<p>é¦–å…ˆæ‰¾åˆ°å¯¹åº”çš„<a target="_blank" rel="noopener" href="https://github.dev/casdoor/casdoor/tree/v1.814.0">github.dev&#x2F;casdoor&#x2F;casdoor&#x2F;tree&#x2F;v1.814.0</a>ç‰ˆæœ¬ï¼ŒæŸ¥çœ‹å…¶<code>main.go</code></p>
<pre class="language-go" data-language="go"><code class="language-go">https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>dev<span class="token operator">/</span>casdoor<span class="token operator">/</span>casdoor<span class="token operator">/</span>blob<span class="token operator">/</span>a5a627f92efd3cc3f3613ca119b340b66258ce64<span class="token operator">/</span>main<span class="token punctuation">.</span><span class="token keyword">go</span>#L65<span class="token operator">-</span>L95
	<span class="token operator">...</span><span class="token punctuation">.</span>
	beego<span class="token punctuation">.</span>BConfig<span class="token punctuation">.</span>WebConfig<span class="token punctuation">.</span>Session<span class="token punctuation">.</span>SessionOn <span class="token operator">=</span> <span class="token boolean">true</span>
	beego<span class="token punctuation">.</span>BConfig<span class="token punctuation">.</span>WebConfig<span class="token punctuation">.</span>Session<span class="token punctuation">.</span>SessionName <span class="token operator">=</span> <span class="token string">"casdoor_session_id"</span>
	<span class="token keyword">if</span> conf<span class="token punctuation">.</span><span class="token function">GetConfigString</span><span class="token punctuation">(</span><span class="token string">"redisEndpoint"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span> <span class="token punctuation">&#123;</span>
		beego<span class="token punctuation">.</span>BConfig<span class="token punctuation">.</span>WebConfig<span class="token punctuation">.</span>Session<span class="token punctuation">.</span>SessionProvider <span class="token operator">=</span> <span class="token string">"file"</span>
		beego<span class="token punctuation">.</span>BConfig<span class="token punctuation">.</span>WebConfig<span class="token punctuation">.</span>Session<span class="token punctuation">.</span>SessionProviderConfig <span class="token operator">=</span> <span class="token string">"./tmp"</span>
	<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
		beego<span class="token punctuation">.</span>BConfig<span class="token punctuation">.</span>WebConfig<span class="token punctuation">.</span>Session<span class="token punctuation">.</span>SessionProvider <span class="token operator">=</span> <span class="token string">"redis"</span>
		beego<span class="token punctuation">.</span>BConfig<span class="token punctuation">.</span>WebConfig<span class="token punctuation">.</span>Session<span class="token punctuation">.</span>SessionProviderConfig <span class="token operator">=</span> conf<span class="token punctuation">.</span><span class="token function">GetConfigString</span><span class="token punctuation">(</span><span class="token string">"redisEndpoint"</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	beego<span class="token punctuation">.</span>BConfig<span class="token punctuation">.</span>WebConfig<span class="token punctuation">.</span>Session<span class="token punctuation">.</span>SessionCookieLifeTime <span class="token operator">=</span> <span class="token number">3600</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">30</span> <span class="token comment">//30å¤©çš„ç¼“å­˜æ—¶é—´</span>
	beego<span class="token punctuation">.</span>BConfig<span class="token punctuation">.</span>WebConfig<span class="token punctuation">.</span>Session<span class="token punctuation">.</span>SessionGCMaxLifetime <span class="token operator">=</span> <span class="token number">3600</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">30</span> <span class="token comment">//30å¤©çš„ç¼“å­˜æ—¶é—´</span>
	<span class="token comment">// beego.BConfig.WebConfig.Session.SessionCookieSameSite = http.SameSiteNoneMode</span>

	err <span class="token operator">:=</span> logs<span class="token punctuation">.</span><span class="token function">SetLogger</span><span class="token punctuation">(</span>logs<span class="token punctuation">.</span>AdapterFile<span class="token punctuation">,</span> conf<span class="token punctuation">.</span><span class="token function">GetConfigString</span><span class="token punctuation">(</span><span class="token string">"logConfig"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	port <span class="token operator">:=</span> beego<span class="token punctuation">.</span>AppConfig<span class="token punctuation">.</span><span class="token function">DefaultInt</span><span class="token punctuation">(</span><span class="token string">"httpport"</span><span class="token punctuation">,</span> <span class="token number">8000</span><span class="token punctuation">)</span>
	<span class="token comment">// logs.SetLevel(logs.LevelInformational)</span>
	logs<span class="token punctuation">.</span><span class="token function">SetLogFuncCall</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>

	err <span class="token operator">=</span> util<span class="token punctuation">.</span><span class="token function">StopOldInstance</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">go</span> ldap<span class="token punctuation">.</span><span class="token function">StartLdapServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">go</span> radius<span class="token punctuation">.</span><span class="token function">StartRadiusServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">go</span> object<span class="token punctuation">.</span><span class="token function">ClearThroughputPerSecond</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	beego<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">":%v"</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<p>åœ¨ä¸Šé¢çš„ä»£ç é‡Œé¢ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°é»˜è®¤æƒ…å†µä¸‹<code>casdoor</code>ä½¿ç”¨äº†<code>SessionProvider</code>ä¸º<code>file</code>ï¼Œå¹¶ä¸”ç›®å½•é…ç½®åˆ°äº†<code>./tmp</code>ä¸‹é¢ï¼Œåé¢å¯åŠ¨çš„å°±æ˜¯<code>beego</code>çš„æœåŠ¡äº†ï¼Œæ‰€ä»¥åé¢æŸ¥çœ‹çš„æ˜¯å¯¹åº”ç‰ˆæœ¬<a target="_blank" rel="noopener" href="https://github.dev/beego/beego/tree/v1.12.11">beego</a>çš„æºç ã€‚</p>
<p>é¦–å…ˆä»<code>beego.go</code>å¼€å§‹å¯åŠ¨æœåŠ¡</p>
<pre class="language-go" data-language="go"><code class="language-go">https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>beego<span class="token operator">/</span>beego<span class="token operator">/</span>blob<span class="token operator">/</span>c280209bf5b94cf31094a200b166c97eb3898851<span class="token operator">/</span>beego<span class="token punctuation">.</span><span class="token keyword">go</span>#L51<span class="token operator">-</span>L73
<span class="token comment">// Run beego application.</span>
<span class="token comment">// beego.Run() default run on HttpPort</span>
<span class="token comment">// beego.Run("localhost")</span>
<span class="token comment">// beego.Run(":8089")</span>
<span class="token comment">// beego.Run("127.0.0.1:8089")</span>
<span class="token keyword">func</span> <span class="token function">Run</span><span class="token punctuation">(</span>params <span class="token operator">...</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token function">initBeforeHTTPRun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//è¿™é‡Œå†ç¨‹åºå¯åŠ¨å‰ï¼Œè°ƒç”¨äº†initBeforeHTTPRunè¿™ä¸ªæ–¹æ³•</span>
	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">""</span> <span class="token punctuation">&#123;</span>
		strs <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">":"</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>strs<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> strs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">""</span> <span class="token punctuation">&#123;</span>
			BConfig<span class="token punctuation">.</span>Listen<span class="token punctuation">.</span>HTTPAddr <span class="token operator">=</span> strs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
		<span class="token punctuation">&#125;</span>
		<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>strs<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> strs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">""</span> <span class="token punctuation">&#123;</span>
			BConfig<span class="token punctuation">.</span>Listen<span class="token punctuation">.</span>HTTPPort<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span>strs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token punctuation">&#125;</span>

		BConfig<span class="token punctuation">.</span>Listen<span class="token punctuation">.</span>Domains <span class="token operator">=</span> params
	<span class="token punctuation">&#125;</span>

	BeeApp<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>
<span class="token operator">...</span><span class="token punctuation">.</span>
https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>beego<span class="token operator">/</span>beego<span class="token operator">/</span>blob<span class="token operator">/</span>c280209bf5b94cf31094a200b166c97eb3898851<span class="token operator">/</span>beego<span class="token punctuation">.</span><span class="token keyword">go</span>#L91<span class="token operator">-</span>L107
<span class="token keyword">func</span> <span class="token function">initBeforeHTTPRun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">//init hooks åœ¨è¿™ä¸ªæ–¹æ³•ä¸­æ³¨å†Œäº†SessionæœåŠ¡</span>
	<span class="token function">AddAPPStartHook</span><span class="token punctuation">(</span>
		registerMime<span class="token punctuation">,</span>
		registerDefaultErrorHandler<span class="token punctuation">,</span>
		registerSession<span class="token punctuation">,</span>
		registerTemplate<span class="token punctuation">,</span>
		registerAdmin<span class="token punctuation">,</span>
		registerGzip<span class="token punctuation">,</span>
	<span class="token punctuation">)</span>

	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> hk <span class="token operator">:=</span> <span class="token keyword">range</span> hooks <span class="token punctuation">&#123;</span>
		<span class="token keyword">if</span> err <span class="token operator">:=</span> <span class="token function">hk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span> <span class="token comment">//åœ¨è¿™é‡Œæ‰§è¡Œäº†æ³¨å†Œçš„sessionæœåŠ¡</span>
			<span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>æŸ¥çœ‹å¯¹åº”çš„<code>registerSession</code>çš„ä»£ç å®ç°ï¼Œåœ¨<code>hook.go</code>ä¸­</p>
<pre class="language-go" data-language="go"><code class="language-go">https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>beego<span class="token operator">/</span>beego<span class="token operator">/</span>blob<span class="token operator">/</span>c280209bf5b94cf31094a200b166c97eb3898851<span class="token operator">/</span>hooks<span class="token punctuation">.</span><span class="token keyword">go</span>#L47<span class="token operator">-</span>L76
<span class="token keyword">func</span> <span class="token function">registerSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">if</span> BConfig<span class="token punctuation">.</span>WebConfig<span class="token punctuation">.</span>Session<span class="token punctuation">.</span>SessionOn <span class="token punctuation">&#123;</span>
		<span class="token keyword">var</span> err <span class="token builtin">error</span>
		sessionConfig <span class="token operator">:=</span> AppConfig<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token string">"sessionConfig"</span><span class="token punctuation">)</span>
		conf <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>session<span class="token punctuation">.</span>ManagerConfig<span class="token punctuation">)</span>
		<span class="token keyword">if</span> sessionConfig <span class="token operator">==</span> <span class="token string">""</span> <span class="token punctuation">&#123;</span>
			<span class="token operator">...</span><span class="token punctuation">.</span>
            conf<span class="token punctuation">.</span>Gclifetime <span class="token operator">=</span> BConfig<span class="token punctuation">.</span>WebConfig<span class="token punctuation">.</span>Session<span class="token punctuation">.</span>SessionGCMaxLifetime <span class="token comment">//å®šä¹‰äº†sessionçš„å­˜æ´»æ—¶é—´</span>
			conf<span class="token punctuation">.</span>ProviderConfig <span class="token operator">=</span> filepath<span class="token punctuation">.</span><span class="token function">ToSlash</span><span class="token punctuation">(</span>BConfig<span class="token punctuation">.</span>WebConfig<span class="token punctuation">.</span>Session<span class="token punctuation">.</span>SessionProviderConfig<span class="token punctuation">)</span> <span class="token comment">//åœ¨è¿™é‡Œtmpçš„é…ç½®å˜æˆäº†æ–‡ä»¶è·¯å¾„é…ç½®</span>
			<span class="token operator">...</span><span class="token punctuation">.</span>
		<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
			<span class="token keyword">if</span> err <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>sessionConfig<span class="token punctuation">)</span><span class="token punctuation">,</span> conf<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
				<span class="token keyword">return</span> err
			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">&#125;</span>
		<span class="token keyword">if</span> GlobalSessions<span class="token punctuation">,</span> err <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">NewManager</span><span class="token punctuation">(</span>BConfig<span class="token punctuation">.</span>WebConfig<span class="token punctuation">.</span>Session<span class="token punctuation">.</span>SessionProvider<span class="token punctuation">,</span> conf<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
			<span class="token keyword">return</span> err
		<span class="token punctuation">&#125;</span>
		<span class="token keyword">go</span> GlobalSessions<span class="token punctuation">.</span><span class="token function">GC</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//è¿™é‡Œä½¿ç”¨äº†GOåç¨‹å¯åŠ¨äº†ä¸€ä¸ªCGæœåŠ¡ï¼Œè¯¥æ“ä½œä¸ä¼šé˜»å¡ä¸»åç¨‹</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>è¿›å…¥<code>GlobalSessions.GC() </code>å‡½æ•°æŸ¥çœ‹å¯¹åº”å®ç°ï¼Œåœ¨<code>session.go</code>ä¸­</p>
<pre class="language-go" data-language="go"><code class="language-go">https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>beego<span class="token operator">/</span>beego<span class="token operator">/</span>blob<span class="token operator">/</span>c280209bf5b94cf31094a200b166c97eb3898851<span class="token operator">/</span>session<span class="token operator">/</span>session<span class="token punctuation">.</span><span class="token keyword">go</span>#L290<span class="token operator">-</span>L295
<span class="token comment">// GC Start session gc process.</span>
<span class="token comment">// it can do gc in times after gc lifetime.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>manager <span class="token operator">*</span>Manager<span class="token punctuation">)</span> <span class="token function">GC</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	manager<span class="token punctuation">.</span>provider<span class="token punctuation">.</span><span class="token function">SessionGC</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//å¯åŠ¨æ—¶å…ˆæ‰§è¡Œä¸€æ¬¡SessionCG ç„¶åå†ä½¿ç”¨time.AfterFuncæ¥å®šæ—¶æ‰§è¡Œ</span>
	time<span class="token punctuation">.</span><span class="token function">AfterFunc</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Duration</span><span class="token punctuation">(</span>manager<span class="token punctuation">.</span>config<span class="token punctuation">.</span>Gclifetime<span class="token punctuation">)</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> manager<span class="token punctuation">.</span><span class="token function">GC</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>è¿›å…¥<code>manager.provider.SessionGC() </code>å‡½æ•°æŸ¥çœ‹å…¶å®ç°ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„<code>sessionProvider</code>ä¸º<code>file</code>ï¼Œæ‰€ä»¥è¦åœ¨<code>session/sess_file.go</code>ä¸­æŸ¥çœ‹å…¶å®ç°</p>
<pre class="language-go" data-language="go"><code class="language-go"><span class="token comment">// filepderçš„å®šä¹‰</span>
https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>beego<span class="token operator">/</span>beego<span class="token operator">/</span>blob<span class="token operator">/</span>c280209bf5b94cf31094a200b166c97eb3898851<span class="token operator">/</span>session<span class="token operator">/</span>sess_file<span class="token punctuation">.</span><span class="token keyword">go</span>#L30<span class="token operator">-</span>L33
<span class="token keyword">var</span> <span class="token punctuation">(</span>
	filepder      <span class="token operator">=</span> <span class="token operator">&amp;</span>FileProvider<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
	gcmaxlifetime <span class="token builtin">int64</span>
<span class="token punctuation">)</span>
https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>beego<span class="token operator">/</span>beego<span class="token operator">/</span>blob<span class="token operator">/</span>c280209bf5b94cf31094a200b166c97eb3898851<span class="token operator">/</span>session<span class="token operator">/</span>sess_file<span class="token punctuation">.</span><span class="token keyword">go</span>#L113<span class="token operator">-</span>L118
<span class="token comment">// FileProvider File session provider</span>
<span class="token keyword">type</span> FileProvider <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
	lock        sync<span class="token punctuation">.</span>RWMutex
	maxlifetime <span class="token builtin">int64</span>
	savePath    <span class="token builtin">string</span>
<span class="token punctuation">&#125;</span>
https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>beego<span class="token operator">/</span>beego<span class="token operator">/</span>blob<span class="token operator">/</span>c280209bf5b94cf31094a200b166c97eb3898851<span class="token operator">/</span>session<span class="token operator">/</span>sess_file<span class="token punctuation">.</span><span class="token keyword">go</span>#L200<span class="token operator">-</span>L207
<span class="token comment">// SessionGC Recycle files in save path</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>fp <span class="token operator">*</span>FileProvider<span class="token punctuation">)</span> <span class="token function">SessionGC</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	filepder<span class="token punctuation">.</span>lock<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//è¿™é‡Œå…ˆé”ä½äº†filepder è¿™ä¸ªé”å¾ˆå…³é”®</span>
	<span class="token keyword">defer</span> filepder<span class="token punctuation">.</span>lock<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	gcmaxlifetime <span class="token operator">=</span> fp<span class="token punctuation">.</span>maxlifetime <span class="token comment">//è·å–gcè¶…æ—¶æ—¶é—´</span>
	filepath<span class="token punctuation">.</span><span class="token function">Walk</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span>savePath<span class="token punctuation">,</span> gcpath<span class="token punctuation">)</span> <span class="token comment">//è¿™é‡Œä½¿ç”¨walkæ¥æµè§ˆsessionæ–‡ä»¶ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå¹¶ä¸”æ‰§è¡Œgcpathçš„å›è°ƒ</span>
<span class="token punctuation">&#125;</span>
<span class="token operator">...</span><span class="token punctuation">.</span>
https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>beego<span class="token operator">/</span>beego<span class="token operator">/</span>blob<span class="token operator">/</span>c280209bf5b94cf31094a200b166c97eb3898851<span class="token operator">/</span>session<span class="token operator">/</span>sess_file<span class="token punctuation">.</span><span class="token keyword">go</span>#L284<span class="token operator">-</span>L296
<span class="token comment">// remove file in save path if expired</span>
<span class="token keyword">func</span> <span class="token function">gcpath</span><span class="token punctuation">(</span>path <span class="token builtin">string</span><span class="token punctuation">,</span> info os<span class="token punctuation">.</span>FileInfo<span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> err
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">if</span> info<span class="token punctuation">.</span><span class="token function">IsDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>info<span class="token punctuation">.</span><span class="token function">ModTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> gcmaxlifetime<span class="token punctuation">)</span> <span class="token operator">&lt;</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		os<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token comment">//å¦‚æœè¯¥æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´åŠ ä¸Šè¶…æ—¶æ—¶é—´å¤§äºå½“å‰æ—¶é—´åˆ™è¿›è¡Œåˆ é™¤</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>åˆ°æ­¤ç¬¬ä¸€ä¸ªé—®é¢˜å·²ç»è§£å†³äº†ï¼Œå°±æ˜¯å› ä¸º<code>beego.go</code>å¯åŠ¨çš„æ—¶å€™ä¼šæ‰§è¡Œsessionçš„GCï¼Œè€Œç¨‹åºé…ç½®ä¸ºåˆ©ç”¨<code>file</code>ä¿å­˜<code>session</code>ï¼Œæ‰€ä»¥å°±è§£é‡Šäº†ä¸ºä»€ä¹ˆæŸ¥çœ‹<code>strace</code>å’Œ<code>pstack</code>çš„æ—¥å¿—æ—¶ä¼šæœ‰é”<code>futex</code> å’Œæ–‡ä»¶è¯»å–çš„<code>newfstatat</code>çš„ç³»ç»Ÿè°ƒç”¨</p>
<h2 id="ä¸ºä»€ä¹ˆæœåŠ¡æ—¥å¿—éƒ½æ˜¾ç¤ºç«¯å£å·²ç»ç›‘å¬äº†ï¼Œä½†æ˜¯curlè¯¥æœåŠ¡è¿˜æ˜¯ä¸èƒ½é©¬ä¸Šè¿”å›è¯·æ±‚"><a href="#ä¸ºä»€ä¹ˆæœåŠ¡æ—¥å¿—éƒ½æ˜¾ç¤ºç«¯å£å·²ç»ç›‘å¬äº†ï¼Œä½†æ˜¯curlè¯¥æœåŠ¡è¿˜æ˜¯ä¸èƒ½é©¬ä¸Šè¿”å›è¯·æ±‚" class="headerlink" title="ä¸ºä»€ä¹ˆæœåŠ¡æ—¥å¿—éƒ½æ˜¾ç¤ºç«¯å£å·²ç»ç›‘å¬äº†ï¼Œä½†æ˜¯curlè¯¥æœåŠ¡è¿˜æ˜¯ä¸èƒ½é©¬ä¸Šè¿”å›è¯·æ±‚"></a>ä¸ºä»€ä¹ˆæœåŠ¡æ—¥å¿—éƒ½æ˜¾ç¤ºç«¯å£å·²ç»ç›‘å¬äº†ï¼Œä½†æ˜¯curlè¯¥æœåŠ¡è¿˜æ˜¯ä¸èƒ½é©¬ä¸Šè¿”å›è¯·æ±‚</h2><p>ä¸ºä»€ä¹ˆæ—¥å¿—å·²ç»æ˜¾ç¤ºäº†ç«¯å£ç»‘å®šäº†ï¼Œä½†æ˜¯<code>curl</code>å¯¹åº”æœåŠ¡è¿˜æ˜¯ä¸é€š</p>
<p>åœ¨ä¸Šé¢æˆ‘ä»¬å¾—çŸ¥æˆ‘ä»¬çš„æœåŠ¡æ˜¯åœ¨<code>beego.go</code>ä¸­å¯åŠ¨çš„ï¼Œæ‰€ä»¥å…ˆæŸ¥çœ‹å…¶æºç </p>
<pre class="language-go" data-language="go"><code class="language-go">https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>beego<span class="token operator">/</span>beego<span class="token operator">/</span>blob<span class="token operator">/</span>c280209bf5b94cf31094a200b166c97eb3898851<span class="token operator">/</span>beego<span class="token punctuation">.</span><span class="token keyword">go</span>#L51<span class="token operator">-</span>L73
<span class="token comment">// Run beego application.</span>
<span class="token comment">// beego.Run() default run on HttpPort</span>
<span class="token comment">// beego.Run("localhost")</span>
<span class="token comment">// beego.Run(":8089")</span>
<span class="token comment">// beego.Run("127.0.0.1:8089")</span>
<span class="token keyword">func</span> <span class="token function">Run</span><span class="token punctuation">(</span>params <span class="token operator">...</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token function">initBeforeHTTPRun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//è¿™é‡Œå†ç¨‹åºå¯åŠ¨å‰ï¼Œè°ƒç”¨äº†initBeforeHTTPRunè¿™ä¸ªæ–¹æ³•</span>
	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">""</span> <span class="token punctuation">&#123;</span>
		strs <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">":"</span><span class="token punctuation">)</span>
		<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>strs<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> strs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">""</span> <span class="token punctuation">&#123;</span>
			BConfig<span class="token punctuation">.</span>Listen<span class="token punctuation">.</span>HTTPAddr <span class="token operator">=</span> strs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
		<span class="token punctuation">&#125;</span>
		<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>strs<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> strs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">""</span> <span class="token punctuation">&#123;</span>
			BConfig<span class="token punctuation">.</span>Listen<span class="token punctuation">.</span>HTTPPort<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">=</span> strconv<span class="token punctuation">.</span><span class="token function">Atoi</span><span class="token punctuation">(</span>strs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
		<span class="token punctuation">&#125;</span>

		BConfig<span class="token punctuation">.</span>Listen<span class="token punctuation">.</span>Domains <span class="token operator">=</span> params
	<span class="token punctuation">&#125;</span>

	BeeApp<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//æ­£å¼å¯åŠ¨æœåŠ¡</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>æˆ‘ä»¬è¿™é‡Œç›´æ¥æŸ¥çœ‹<code>BeeApp.Run()</code>çš„å®ç°</p>
<pre class="language-go" data-language="go"><code class="language-go">https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>beego<span class="token operator">/</span>beego<span class="token operator">/</span>blob<span class="token operator">/</span>c280209bf5b94cf31094a200b166c97eb3898851<span class="token operator">/</span>app<span class="token punctuation">.</span><span class="token keyword">go</span>#L62<span class="token operator">-</span>L239
<span class="token comment">// Run beego application.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>app <span class="token operator">*</span>App<span class="token punctuation">)</span> <span class="token function">Run</span><span class="token punctuation">(</span>mws <span class="token operator">...</span>MiddleWare<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	addr <span class="token operator">:=</span> BConfig<span class="token punctuation">.</span>Listen<span class="token punctuation">.</span>HTTPAddr

	<span class="token keyword">if</span> BConfig<span class="token punctuation">.</span>Listen<span class="token punctuation">.</span>HTTPPort <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>
		addr <span class="token operator">=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">"%s:%d"</span><span class="token punctuation">,</span> BConfig<span class="token punctuation">.</span>Listen<span class="token punctuation">.</span>HTTPAddr<span class="token punctuation">,</span> BConfig<span class="token punctuation">.</span>Listen<span class="token punctuation">.</span>HTTPPort<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	app<span class="token punctuation">.</span>Server<span class="token punctuation">.</span>Handler <span class="token operator">=</span> app<span class="token punctuation">.</span>Handlers <span class="token comment">//è¿™é‡Œçš„app.Handlerså°±æ˜¯å®šä¹‰å¥½çš„è·¯ç”±å’ŒæœåŠ¡ï¼ŒæŠŠå®ƒæ³¨å†Œåˆ°httpæœåŠ¡çš„å›è°ƒé‡Œé¢</span>
	<span class="token comment">// run cgi server</span>
	<span class="token keyword">if</span> BConfig<span class="token punctuation">.</span>Listen<span class="token punctuation">.</span>EnableFcgi <span class="token punctuation">&#123;</span>
		<span class="token operator">...</span><span class="token punctuation">.</span>
	<span class="token punctuation">&#125;</span>
	<span class="token operator">...</span><span class="token punctuation">.</span>
	<span class="token comment">// run graceful mode</span>
	<span class="token keyword">if</span> BConfig<span class="token punctuation">.</span>Listen<span class="token punctuation">.</span>Graceful <span class="token punctuation">&#123;</span>
        <span class="token operator">...</span>
	<span class="token punctuation">&#125;</span>
	<span class="token comment">// run normal mode</span>
	<span class="token keyword">if</span> BConfig<span class="token punctuation">.</span>Listen<span class="token punctuation">.</span>EnableHTTPS <span class="token operator">||</span> BConfig<span class="token punctuation">.</span>Listen<span class="token punctuation">.</span>EnableMutualHTTPS <span class="token punctuation">&#123;</span>
		<span class="token operator">...</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">if</span> BConfig<span class="token punctuation">.</span>Listen<span class="token punctuation">.</span>EnableHTTP <span class="token punctuation">&#123;</span>
		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			app<span class="token punctuation">.</span>Server<span class="token punctuation">.</span>Addr <span class="token operator">=</span> addr
			logs<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">"http server Running on http://%s"</span><span class="token punctuation">,</span> app<span class="token punctuation">.</span>Server<span class="token punctuation">.</span>Addr<span class="token punctuation">)</span> <span class="token comment">//å¯¹åº”çš„casdooræ—¥å¿—æ‰“å°çš„åœ°æ–¹</span>
			<span class="token keyword">if</span> BConfig<span class="token punctuation">.</span>Listen<span class="token punctuation">.</span>ListenTCP4 <span class="token punctuation">&#123;</span>
                <span class="token operator">...</span>
			<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
				<span class="token keyword">if</span> err <span class="token operator">:=</span> app<span class="token punctuation">.</span>Server<span class="token punctuation">.</span><span class="token function">ListenAndServe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span> <span class="token comment">//æœåŠ¡å¯åŠ¨äº†</span>
					logs<span class="token punctuation">.</span><span class="token function">Critical</span><span class="token punctuation">(</span><span class="token string">"ListenAndServe: "</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
					time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">100</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Microsecond<span class="token punctuation">)</span>
					endRunning <span class="token operator">&lt;-</span> <span class="token boolean">true</span>
				<span class="token punctuation">&#125;</span>
			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	<span class="token operator">&lt;-</span>endRunning
<span class="token punctuation">&#125;</span></code></pre>

<p>é‚£ä¹ˆå½“æœ‰è¯·æ±‚è¿‡æ¥çš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨<code>app.Handlers</code>ä¸­çš„<code>ServeHTTP</code>æ¥å¤„ç†(å¿…é¡»å®ç°<a target="_blank" rel="noopener" href="https://cs.opensource.google/go/go/+/go1.24.2:src/net/http/server.go;l=2290">HandlerFunc</a> )ï¼Œ<code>app.Handlers</code>å°±åœ¨<code>route.go</code>é‡Œé¢</p>
<pre class="language-go" data-language="go"><code class="language-go">https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>beego<span class="token operator">/</span>beego<span class="token operator">/</span>blob<span class="token operator">/</span>c280209bf5b94cf31094a200b166c97eb3898851<span class="token operator">/</span>router<span class="token punctuation">.</span><span class="token keyword">go</span>#L693<span class="token operator">-</span>L975
<span class="token comment">// Implement http.Handler interface.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>ControllerRegister<span class="token punctuation">)</span> <span class="token function">ServeHTTP</span><span class="token punctuation">(</span>rw http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	startTime <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token operator">...</span><span class="token punctuation">.</span>
    https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>beego<span class="token operator">/</span>beego<span class="token operator">/</span>blob<span class="token operator">/</span>c280209bf5b94cf31094a200b166c97eb3898851<span class="token operator">/</span>router<span class="token punctuation">.</span><span class="token keyword">go</span>#L756<span class="token operator">-</span>L770
	<span class="token comment">// session init åœ¨è¿™é‡Œå°†ä¼šå¤„ç†è¯·æ±‚ä¸­çš„session</span>
	<span class="token keyword">if</span> BConfig<span class="token punctuation">.</span>WebConfig<span class="token punctuation">.</span>Session<span class="token punctuation">.</span>SessionOn <span class="token punctuation">&#123;</span>
		<span class="token keyword">var</span> err <span class="token builtin">error</span>
		context<span class="token punctuation">.</span>Input<span class="token punctuation">.</span>CruSession<span class="token punctuation">,</span> err <span class="token operator">=</span> GlobalSessions<span class="token punctuation">.</span><span class="token function">SessionStart</span><span class="token punctuation">(</span>rw<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token comment">//é€šè¿‡rwå’Œrè·å–å¯¹åº”çš„sessionä¿¡æ¯</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
			logs<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
			<span class="token function">exception</span><span class="token punctuation">(</span><span class="token string">"503"</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span>
			<span class="token keyword">goto</span> Admin
		<span class="token punctuation">&#125;</span>
		<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			<span class="token keyword">if</span> context<span class="token punctuation">.</span>Input<span class="token punctuation">.</span>CruSession <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
				context<span class="token punctuation">.</span>Input<span class="token punctuation">.</span>CruSession<span class="token punctuation">.</span><span class="token function">SessionRelease</span><span class="token punctuation">(</span>rw<span class="token punctuation">)</span>
			<span class="token punctuation">&#125;</span>
		<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	<span class="token operator">...</span>
<span class="token punctuation">&#125;</span></code></pre>

<p><code>GlobalSessions.SessionStart</code>å…¶å®ç°çš„æ–¹æ³•åœ¨<code>session/session.go</code>ä¸­</p>
<pre class="language-go" data-language="go"><code class="language-go">https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>beego<span class="token operator">/</span>beego<span class="token operator">/</span>blob<span class="token operator">/</span>c280209bf5b94cf31094a200b166c97eb3898851<span class="token operator">/</span>session<span class="token operator">/</span>session<span class="token punctuation">.</span><span class="token keyword">go</span>#L207<span class="token operator">-</span>L253
<span class="token comment">// SessionStart generate or read the session id from http request.</span>
<span class="token comment">// if session id exists, return SessionStore with this id.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>manager <span class="token operator">*</span>Manager<span class="token punctuation">)</span> <span class="token function">SessionStart</span><span class="token punctuation">(</span>w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span> r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">)</span> <span class="token punctuation">(</span>session Store<span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    sid<span class="token punctuation">,</span> errs <span class="token operator">:=</span> manager<span class="token punctuation">.</span><span class="token function">getSid</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token comment">// åœ¨è¯·æ±‚ä¸­è·å–sid (sessionId)</span>
	<span class="token keyword">if</span> errs <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> errs
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">if</span> sid <span class="token operator">!=</span> <span class="token string">""</span> <span class="token operator">&amp;&amp;</span> manager<span class="token punctuation">.</span>provider<span class="token punctuation">.</span><span class="token function">SessionExist</span><span class="token punctuation">(</span>sid<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// å¦‚æœè·å–åˆ°å°±ç”¨idæ¥æŸ¥çœ‹å¯¹åº”çš„sessionStoreï¼Œå¯ä»¥é€šè¿‡sessionStoreæ¥ç®¡ç†sessoin</span>
		<span class="token keyword">return</span> manager<span class="token punctuation">.</span>provider<span class="token punctuation">.</span><span class="token function">SessionRead</span><span class="token punctuation">(</span>sid<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>

	<span class="token comment">// Generate a new session å¦‚æœè·å–ä¸åˆ°sessionå°±é‡æ–°ç”Ÿæˆsession</span>
	sid<span class="token punctuation">,</span> errs <span class="token operator">=</span> manager<span class="token punctuation">.</span><span class="token function">sessionID</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> errs <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> errs
	<span class="token punctuation">&#125;</span>

	session<span class="token punctuation">,</span> err <span class="token operator">=</span> manager<span class="token punctuation">.</span>provider<span class="token punctuation">.</span><span class="token function">SessionRead</span><span class="token punctuation">(</span>sid<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">&#125;</span>
    <span class="token comment">// è®¾ç½®ä¸€ä¸ªcookieï¼ŒæŠŠsidæ”¾åˆ°cookieä¸­ï¼Œä¸‹æ¬¡å³å¯åœ¨è¯·æ±‚ä¸­è·å–å¯¹åº”çš„sidï¼Œä»è€Œè·å–session</span>
	cookie <span class="token operator">:=</span> <span class="token operator">&amp;</span>http<span class="token punctuation">.</span>Cookie<span class="token punctuation">&#123;</span>
		Name<span class="token punctuation">:</span>     manager<span class="token punctuation">.</span>config<span class="token punctuation">.</span>CookieName<span class="token punctuation">,</span>
		Value<span class="token punctuation">:</span>    url<span class="token punctuation">.</span><span class="token function">QueryEscape</span><span class="token punctuation">(</span>sid<span class="token punctuation">)</span><span class="token punctuation">,</span>
		Path<span class="token punctuation">:</span>     <span class="token string">"/"</span><span class="token punctuation">,</span>
		HttpOnly<span class="token punctuation">:</span> <span class="token operator">!</span>manager<span class="token punctuation">.</span>config<span class="token punctuation">.</span>DisableHTTPOnly<span class="token punctuation">,</span>
		Secure<span class="token punctuation">:</span>   manager<span class="token punctuation">.</span><span class="token function">isSecure</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">,</span>
		Domain<span class="token punctuation">:</span>   manager<span class="token punctuation">.</span>config<span class="token punctuation">.</span>Domain<span class="token punctuation">,</span>
		SameSite<span class="token punctuation">:</span> manager<span class="token punctuation">.</span>config<span class="token punctuation">.</span>CookieSameSite<span class="token punctuation">,</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">if</span> manager<span class="token punctuation">.</span>config<span class="token punctuation">.</span>CookieLifeTime <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>
		cookie<span class="token punctuation">.</span>MaxAge <span class="token operator">=</span> manager<span class="token punctuation">.</span>config<span class="token punctuation">.</span>CookieLifeTime
		cookie<span class="token punctuation">.</span>Expires <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Duration</span><span class="token punctuation">(</span>manager<span class="token punctuation">.</span>config<span class="token punctuation">.</span>CookieLifeTime<span class="token punctuation">)</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">if</span> manager<span class="token punctuation">.</span>config<span class="token punctuation">.</span>EnableSetCookie <span class="token punctuation">&#123;</span>
		http<span class="token punctuation">.</span><span class="token function">SetCookie</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> cookie<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
	r<span class="token punctuation">.</span><span class="token function">AddCookie</span><span class="token punctuation">(</span>cookie<span class="token punctuation">)</span>

	<span class="token keyword">if</span> manager<span class="token punctuation">.</span>config<span class="token punctuation">.</span>EnableSidInHTTPHeader <span class="token punctuation">&#123;</span>
		r<span class="token punctuation">.</span>Header<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>manager<span class="token punctuation">.</span>config<span class="token punctuation">.</span>SessionNameInHTTPHeader<span class="token punctuation">,</span> sid<span class="token punctuation">)</span>
		w<span class="token punctuation">.</span><span class="token function">Header</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>manager<span class="token punctuation">.</span>config<span class="token punctuation">.</span>SessionNameInHTTPHeader<span class="token punctuation">,</span> sid<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">return</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>åœ¨ä¸Šè¿°çš„æºç ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥è¦å…³æ³¨é‡Œé¢çš„<code>SessionExist</code>ã€<code>SessionRead</code> çš„å®ç°ï¼Œæ‰€ä»¥æˆ‘ä»¬æŸ¥çœ‹å¯¹åº”çš„æºç ï¼Œåœ¨<code>session/sess_file.go</code>ä¸­</p>
<pre class="language-go" data-language="go"><code class="language-go">https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>beego<span class="token operator">/</span>beego<span class="token operator">/</span>blob<span class="token operator">/</span>c280209bf5b94cf31094a200b166c97eb3898851<span class="token operator">/</span>session<span class="token operator">/</span>sess_file<span class="token punctuation">.</span><span class="token keyword">go</span>#L176<span class="token operator">-</span>L190
<span class="token comment">// SessionExist Check file session exist.</span>
<span class="token comment">// it checks the file named from sid exist or not.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>fp <span class="token operator">*</span>FileProvider<span class="token punctuation">)</span> <span class="token function">SessionExist</span><span class="token punctuation">(</span>sid <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">&#123;</span>
	filepder<span class="token punctuation">.</span>lock<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// è¿™é‡Œè·Ÿä¸Šé¢çš„sessionCGä¸€æ ·ï¼Œä¸Šé”äº†</span>
	<span class="token keyword">defer</span> filepder<span class="token punctuation">.</span>lock<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>sid<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2</span> <span class="token punctuation">&#123;</span>
		SLogger<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"min length of session id is 2"</span><span class="token punctuation">,</span> sid<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span>
	<span class="token punctuation">&#125;</span>

	<span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Stat</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span>savePath<span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>sid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>sid<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sid<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> err <span class="token operator">==</span> <span class="token boolean">nil</span>
<span class="token punctuation">&#125;</span>

https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>beego<span class="token operator">/</span>beego<span class="token operator">/</span>blob<span class="token operator">/</span>c280209bf5b94cf31094a200b166c97eb3898851<span class="token operator">/</span>session<span class="token operator">/</span>sess_file<span class="token punctuation">.</span><span class="token keyword">go</span>#L128<span class="token operator">-</span>L176
<span class="token comment">// SessionRead Read file session by sid.</span>
<span class="token comment">// if file is not exist, create it.</span>
<span class="token comment">// the file path is generated from sid string.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>fp <span class="token operator">*</span>FileProvider<span class="token punctuation">)</span> <span class="token function">SessionRead</span><span class="token punctuation">(</span>sid <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>Store<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	invalidChars <span class="token operator">:=</span> <span class="token string">"./"</span>
	<span class="token operator">...</span>
	filepder<span class="token punctuation">.</span>lock<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// è¿™é‡Œè·Ÿä¸Šé¢çš„sessionCGä¸€æ ·ï¼Œä¸Šé”äº†</span>
	<span class="token keyword">defer</span> filepder<span class="token punctuation">.</span>lock<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">MkdirAll</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span>savePath<span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>sid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>sid<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0755</span><span class="token punctuation">)</span> <span class="token comment">//åˆ›å»ºå¯¹åº”çš„æ–‡ä»¶å¤¹</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		SLogger<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span>
    <span class="token comment">// è·å–æ–‡ä»¶å¹¶å†™å…¥sessionä¿¡æ¯æˆ–è€…åˆ›å»ºå¯¹åº”çš„æ–‡ä»¶å¹¶å†™å…¥sessionä¿¡æ¯</span>
	<span class="token boolean">_</span><span class="token punctuation">,</span> err <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">Stat</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span>savePath<span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>sid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>sid<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sid<span class="token punctuation">)</span><span class="token punctuation">)</span> 
	<span class="token keyword">var</span> f <span class="token operator">*</span>os<span class="token punctuation">.</span>File
	<span class="token keyword">if</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		f<span class="token punctuation">,</span> err <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">OpenFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span>savePath<span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>sid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>sid<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sid<span class="token punctuation">)</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>O_RDWR<span class="token punctuation">,</span> <span class="token number">0777</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> os<span class="token punctuation">.</span><span class="token function">IsNotExist</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		f<span class="token punctuation">,</span> err <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span>savePath<span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>sid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>sid<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sid<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">defer</span> f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// ä¿®æ”¹æ–‡ä»¶Modifyæ—¶é—´ï¼Œåœ¨CGä¸­ä¹Ÿæ˜¯é€šè¿‡è¯¥å±æ€§åˆ¤æ–­æ–‡ä»¶æ˜¯å¦è¦è¢«CG</span>
	os<span class="token punctuation">.</span><span class="token function">Chtimes</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>fp<span class="token punctuation">.</span>savePath<span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>sid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">string</span><span class="token punctuation">(</span>sid<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sid<span class="token punctuation">)</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">var</span> kv <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token keyword">interface</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token comment">// è¯»å–sessionä¿¡æ¯</span>
	b<span class="token punctuation">,</span> err <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadAll</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
	<span class="token punctuation">&#125;</span>
	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>
		kv <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token keyword">interface</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
		kv<span class="token punctuation">,</span> err <span class="token operator">=</span> <span class="token function">DecodeGob</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span>
			<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> err
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>

	ss <span class="token operator">:=</span> <span class="token operator">&amp;</span>FileSessionStore<span class="token punctuation">&#123;</span>sid<span class="token punctuation">:</span> sid<span class="token punctuation">,</span> values<span class="token punctuation">:</span> kv<span class="token punctuation">&#125;</span>
	<span class="token keyword">return</span> ss<span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œå°±å¯ä»¥è§£é‡Šï¼Œä¸ºä»€ä¹ˆæ—¥å¿—æ˜¾ç¤ºæœåŠ¡å¯åŠ¨äº†ï¼Œä½†æ˜¯è¯·æ±‚å°±æ˜¯ä¸è¡Œ</p>
<p>å› ä¸ºåœ¨ä¸€å¼€å§‹å¯åŠ¨çš„æ—¶å€™ï¼Œ<code>beego</code>å°±ä¼šè‡ªå·±å¯¹<code>session</code>æ–‡ä»¶è¿›è¡ŒCGåŒæ—¶<code>lock</code>äº†ä¸€ä¸ª<code>RWMutex</code></p>
<p>åé¢è¯·æ±‚è¿‡æ¥çš„æ—¶å€™ï¼Œ<code>beego</code>åˆä¼šè¯»å–ä¸ºäº†è¯»<code>session</code>è€Œä¸Šé”ï¼Œä½†æ˜¯å¦‚æœå‰é¢çš„<code>CG</code>è¿˜æœªæ‰§è¡Œå®Œæˆï¼Œé‚£ä¹ˆè¿™ä¸ªå°±ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°å¯ä»¥ä¸Šé”ä¸ºæ­¢</p>
<p>æ‰€ä»¥å½“<code>tmp</code>çš„<code>session</code>æ–‡ä»¶è¿‡å¤šï¼Œé‚£ä¹ˆå¯åŠ¨çš„æ—¶å€™å°±è¦èŠ±å¤§é‡æ—¶é—´è¿›è¡Œ<code>CG</code>å¯¼è‡´è¯·æ±‚è¢«å¡ä½ï¼Œä¹Ÿè¯´æ˜ä¸ºä»€ä¹ˆåœ¨ç”Ÿäº§ç¯å¢ƒä¸­<code>nfs</code>çš„æŒ‚è½½è¿›ç¨‹ä¼š<code>cpu</code>è¿‡é«˜ï¼Œç„¶åæŠŠ<code>nfs</code>å–æ¶ˆæŒ‚è½½å(<code>tmp</code>ä¸­çš„<code>session</code>è¢«æ¸…ç©ºå)ï¼Œå¯åŠ¨åé©¬ä¸Šå°±å¯ä»¥æ­£å¸¸è®¿é—®äº†</p>
<p>ä»¥ä¸‹æ˜¯åœ¨æµ‹è¯•ç¯å¢ƒçš„æ¨¡æ‹Ÿ</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@rocky-testing casdoor<span class="token punctuation">]</span><span class="token comment"># du -h --max-depth=1 ./shared-tmp/ </span>
<span class="token punctuation">..</span><span class="token punctuation">..</span>
31G     ./shared-tmp/ <span class="token comment"># è¿™é‡Œå¼„äº†ä¸€ä¸ª31Gçš„sessionè¯·æ±‚</span></code></pre>

<p>é‡å¯ä¸€ä¸ª<code>casdoor</code>æœåŠ¡åï¼Œ<code>curl</code>è¯¥æœåŠ¡</p>
<p><img src="/2025/04/03/casdoor%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8%E5%8D%B4%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AE%E6%8E%92%E9%9A%9C/curl-8001.png" alt="log"></p>
<p>åœ¨ç¬¬ä¸€ä¸ªcurlé€šäº†ä»¥åï¼Œåé¢çš„curlæœåŠ¡å“åº”æ—¶é—´æ‰ä¼šæ­£å¸¸</p>
<p><img src="/2025/04/03/casdoor%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8%E5%8D%B4%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AE%E6%8E%92%E9%9A%9C/curl-8001-normal.png" alt="log"></p>
<h2 id="ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿè¿™ä¹ˆå¤štmpæ–‡ä»¶"><a href="#ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿè¿™ä¹ˆå¤štmpæ–‡ä»¶" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿè¿™ä¹ˆå¤štmpæ–‡ä»¶"></a>ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿè¿™ä¹ˆå¤štmpæ–‡ä»¶</h2><p>ä¸ºä»€ä¹ˆä¸€å¤©å¤šçš„æ—¶é—´ï¼Œ<code>tmp</code>æ–‡ä»¶ä¼šäº§ç”Ÿå¾ˆå¤šçš„æ–‡ä»¶ï¼Œå ç”¨æ¯”è¾ƒå¤§çš„å­˜å‚¨ï¼Ÿ</p>
<p>è¿™å°±ä¸å¾—ä¸æè¿™ä¸ª<code>casdoor</code>äº†ï¼Œä»ä¸Šé¢æˆ‘ä»¬çŸ¥é“<code>casdoor</code>å¯ä»¥è®©æ˜¯ç”¨æ¥è§£å†³ç”¨æˆ·åœ¨å¤šä¸ªåº”ç”¨ä¸­çš„ç™»å½•é—®é¢˜çš„ï¼Œé‚£ä¹ˆåº”ç”¨åœ¨ç”¨æˆ·ç™»å½•çš„æ—¶å€™å°±è¦è®¿é—®<code>casdoor</code>è·å–ç”¨æˆ·çš„ä¿¡æ¯ï¼Œè€Œåˆšå¥½ï¼Œæˆ‘ä»¬åœ¨ç”Ÿäº§çš„ç¯å¢ƒä¸­ï¼Œæœ‰ä¸€ä¸ªæœåŠ¡å¤§æ¦‚ä¼šæ¯ç§’è¯·æ±‚<code>casdoor</code>æœåŠ¡3æ¬¡å·¦å³(åé¢æ”¹æˆåˆ©ç”¨ç¼“å­˜æœºåˆ¶äº†)ï¼ŒåŒæ—¶<code>casdoor</code>å†…éƒ¨çš„ç¼“å­˜è¶…æ—¶æ—¶é—´é…ç½®è®¾ç½®æˆäº†30å¤©ğŸ™ï¼Œè€Œ<code>beego</code>è‡ªå·±é»˜è®¤æ˜¯1å°æ—¶ã€‚</p>
<p>è¿™é‡Œåˆæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œ<code>beego</code>é‡Œé¢çš„<code>session/session.go</code>ä¸­ä¸æ˜¯æœ‰<code>manager.provider.SessionExist</code>æ¥æŸ¥çœ‹<code>sid</code>æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨çš„è¯æ‰åˆ›å»ºæ–°çš„ã€‚å¯¹çš„ï¼Œè¿™ä¸ªå¯¹ä¸€èˆ¬ç½‘é¡µä¸Šä½¿ç”¨çš„ç”¨æˆ·æ¥è¯´æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œå› ä¸ºæµè§ˆå™¨ä¼šå¸®ä½ æŠŠ<code>cookie</code>æ”¾åˆ°æ¯æ¬¡çš„è¯·æ±‚ä¸­ï¼Œæ‰€ä»¥ä¸€ä¸ªç”¨æˆ·åªç”¨åˆ›å»ºä¸€ä¸ª<code>sid</code>å³å¯ï¼Œä½†æ˜¯è¿™ä¸ªæ˜¯åº”ç”¨çš„è¯·æ±‚ï¼Œå–å†³äºç¼–å†™åº”ç”¨çš„äººæœ‰æ²¡æœ‰æŠŠ<code>cookie</code>æˆ–è€…<code>sid</code>ç»™ä½ ä¼ é€’è¿‡æ¥ï¼Œå¦‚æœæ²¡æœ‰ä¼ é€’å°±ä¼šå‡ºç°æ¯æ¬¡è¯·æ±‚éƒ½æœ‰é‡æ–°åˆ›å»ºä¸€ä¸ª<code>sid</code>å’Œå¯¹åº”çš„<code>session</code>ä¿¡æ¯</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ ¹æ®ä¸Šè¿°çš„åˆ†æï¼Œæˆ‘ç”»å‡ºæ¥äº†æ•´ä¸ªè¯·æ±‚æµç¨‹å›¾</p>
<p><img src="/2025/04/03/casdoor%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8%E5%8D%B4%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AE%E6%8E%92%E9%9A%9C/%E6%B5%81%E7%A8%8B%E5%9B%BE.png" alt="log"></p>
<p>åŒæ—¶å¾—å‡ºè¿™æ¬¡çš„é—®é¢˜<strong>åº”è¯¥æ˜¯</strong><code>beego</code>æ¡†æ¶çš„é—®é¢˜ğŸ¤¥ï¼Œä½†æ˜¯<code>casdoor</code>ä¹Ÿæ˜¯å­˜åœ¨è¿™ä¸€äº›é—®é¢˜çš„<del>ï¼ˆæ„Ÿè§‰åƒæ˜¯æœ€ä½³å®è·µï¼‰</del></p>
<p>é¦–å…ˆ<code>casdoor</code>çš„ç¼“å­˜è®¾ç½®æˆç«‹30å¤©ï¼Œå¦‚æœç”¨çš„æ˜¯<code>file</code>ä½œä¸º<code>sessionProvider</code>ï¼Œå½“ç”¨æˆ·æ•°é‡å¤šçš„æ—¶å€™è¿˜æ˜¯ä¼šæœ‰é—®é¢˜ï¼Œæˆ–è€…ä½¿ç”¨<code>redis</code>æ¥åš<code>session</code>ç¼“å­˜ï¼Œè‡³å°‘<code>io</code>æ€§èƒ½æ¯”ç£ç›˜è¦å¿«ï¼Œ<code>sessionCG</code>æ—¶é—´ä¹Ÿå¿«</p>
<p>é™¤äº†ä¸Šé¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬åœ¨å…¶å®ƒåœ°æ–¹ä¹Ÿå‘ç°äº†ä¸€äº›é—®é¢˜</p>
<p>æ¯”å¦‚åœ¨è®¿é—®<code>/api/get-groups</code>æ—¶ï¼Œå¯¹åº”çš„æ¥å£åœ¨è°ƒç”¨çš„æ—¶å€™æ²¡æœ‰ä¼ åˆ†é¡µå‚æ•°ï¼Œæ‰€ä»¥ä¼šå…¨æŸ¥æ•°æ®è¡¨ï¼Œåˆšå¥½é‡Œé¢æœ‰ä¸ªè·å–å¤šæ¡æ•°æ®ï¼Œç„¶åå¾ªç¯å¤šæ¡æ•°æ®å¹¶åç¨‹æŸ¥è¯¢æ•°æ®åº“ï¼Œé‚£ä¸ªæ—¶å€™åˆšå¥½æˆ‘ä»¬å¼„äº†å¾ˆå¤šæµ‹è¯•æ•°æ®ï¼Œå¯¼è‡´è¯¥ç¯å¢ƒä¸‹è°ƒç”¨è¯¥æ¥å£å°±ä¼šæŠŠæ•°æ®åº“è¿æ¥æ‰“æ»¡äº†ã€‚åé¢å¤„ç†æ–¹æ¡ˆåº”è¯¥æ˜¯æ›´æ¢äº†å…¶å®ƒç‰ˆæœ¬çš„<code>casdoor</code>ï¼Œåœ¨ç›®å‰ç¯å¢ƒçš„é‚£ä¸ªç‰ˆæœ¬æ‰¾ä¸åˆ°å¯¹åº”çš„æ¥å£ä¿¡æ¯äº†ã€‚</p>

        
        <br />
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>
        <div id="lv-container"></div>
        <div class="giscus"></div>
    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        
        <li>
            <a target="_blank"  href="https://github.com/kehaha-5">
                            <span class="fa-stack fa-lg">
                                <i class="iconfont icon-github"></i>
                            </span>
            </a>
        </li>
        

        

    </ul>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        Created By <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>  Theme <a target="_blank" rel="noopener" href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.json"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

<script src="/js/index.js"></script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




    <script src="https://giscus.app/client.js"
        data-repo="kehaha-5/kehaha-5.github.io"
        data-repo-id="R_kgDOLah6DA"
        data-category="Announcements"
        data-category-id="DIC_kwDOLah6DM4CvJGE"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="preferred_color_scheme"
        data-lang="zh-CN"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>




</html>

<!-- fancybox support -->

    <!-- for theme: default is false -->
    <!-- for page: default is true -->
    
<script src="/js/fancybox/jquery.fancybox.min.js" key="fancybox_js"></script>
<script src="/js/fancybox/wrapImage.js" key="wrap_image_js"></script>

        
<link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css" key="fancybox_css">

            